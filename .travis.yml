---
language: go

sudo: required
dist: trusty

services:
 - docker

go:
 - 1.9

before_install:
 - curl https://raw.githubusercontent.com/golang/dep/master/install.sh | sh
 - dep ensure -vendor-only

install:
 - GOOS=linux go build -o keysync cmd/keysync/keysync.go
 - GOOS=linux go build -o keyrestore cmd/keyrestore/keyrestore.go
 - GOOS=darwin go build -o keysync cmd/keysync/keysync.go
 - GOOS=darwin go build -o keyrestore cmd/keyrestore/keyrestore.go
 - docker build -t keysync-test -f Dockerfile-test .

script:
 - go test -v .
 - docker run -it keysync-test
